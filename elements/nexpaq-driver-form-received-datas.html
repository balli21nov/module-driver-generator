<!-- Load the Polymer.Element base class -->
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../mixins/nexpaq-driver-common-functions.html">
<link rel="import" href="../styles/nexpaq-driver-form-common-styles.html">
<link rel="import" href="nexpaq-driver-form-received-data.html">

<dom-module id="nexpaq-driver-form-received-datas">
  <template>
  	<style include="nexpaq-driver-form-common-styles">

      :host {
        display: block;
        box-sizing: border-box;
        padding: 0 10px 10px 10px;
        position: relative;
        overflow: auto;
      }

    </style>
    <template is="dom-if" if="{{receivedData.data.length}}">
      <h4 class="header">{{localize('receivingData')}}</h4>
    	<!-- <span class="field">{{localize('data')}}</span> -->
    </template>
	  <template is="dom-repeat" items="{{receivedData.data}}" as="dataInReceived" index-as="dataInReceivedIndex">
      <nexpaq-driver-form-received-data data="{{dataInReceived}}" language="[[language]]" resources="[[resources]]" data-index$="[[dataInReceivedIndex]]" on-user-received-data-delete-request="removeDataInReceived" valid="{{valid}}"></nexpaq-driver-form-received-data>
    </template>
    <paper-button raised class="indigo main outer" on-click="addMoreReceivedData"> + Add Data</paper-button>
  </template>
  <script>
    class NexpaqDriverFormReceivedDatas extends Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior], NexpaqDriverCommonFunctions(Polymer.Element)){
      static get is() { return 'nexpaq-driver-form-received-datas' }
      static get properties() {
        return {
          receivedData: {
            type: Object,
            notify: true,
            reflectToAttribute: true,
            value: function() {
              return {};
            }
          },
          valid: {
            type: Boolean,
            notify: true,
            value: function() {
              return true;
            }
          }
        }
      }

      addMoreReceivedData(e) {
        if(this.receivedData.data == null) {
          this.set('receivedData.data', []);
        }
        var item = 'receivedData.data';
        this.push(item,{});
      }

      removeDataInReceived(e) {
        // Removing current item from array
        var index = e.currentTarget.dataset.index;
        this.splice('receivedData.data', index, 1);

        // if there are no more items in array, then removing array
        if(this.receivedData.data.length == 0) {
          delete this.receivedData.data;
          this.notifyPath('receivedData.data', false);
        }
      }
    }
    customElements.define(NexpaqDriverFormReceivedDatas.is, NexpaqDriverFormReceivedDatas);
  </script>
</dom-module>
