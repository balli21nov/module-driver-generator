<!-- Load the Polymer.Element base class -->
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../styles/nexpaq-driver-form-common-styles.html">
<link rel="import" href="../mixins/nexpaq-driver-common-functions.html">
<link rel="import" href="nexpaq-driver-form-arguments.html">
<link rel="import" href="nexpaq-driver-form-data.html">

<dom-module id="nexpaq-driver-form-sent-data">
  <template>
  	<style include="nexpaq-driver-form-common-styles">

      :host {
        display: block;
        box-sizing: border-box;
        padding: 10px 10px 0 10px;
        position: relative;
        overflow: auto;
      }

    </style>

    <paper-input always-float-label id="type"  label="{{localize('moduleType')}}" value="{{sentData.type}}" required auto-validate allowed-pattern="[A-Za-z_\.\-0-9]" error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
    <paper-tooltip for="type" offset="-7" position="bottom">ex : nexpaq.module.led</paper-tooltip>
    <paper-input always-float-label id="version" label="{{localize('driverVersion')}}" value="{{sentData.version}}" required auto-validate allowed-pattern="[0-9_\.]" error-message="This field is required!" maxlength="20" on-change="validateForm"></paper-input>
    <paper-tooltip for="version" offset="-7" position="bottom">ex : 1.0.0</paper-tooltip>

    <template is="dom-if" if="{{commandAdded}}">
      <h4 class="header">{{localize('moduleCommands')}}</h4>
      <div class="subfield-container">
        <template is="dom-repeat" items="{{sentData.commands}}" as="command" index-as="commandIndex">
          <span class="close" on-click="removeCommand">&times;</span>
          <paper-input always-float-label id="name" label="{{localize('name')}}" value="{{command.name}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
          <paper-tooltip for="name" offset="-7" position="bottom">ex : SetRGB</paper-tooltip>
          <paper-input always-float-label id="title" label="{{localize('title')}}" value="{{command.title}}" required auto-validate error-message="This field is required!" maxlength="80" on-change="validateForm"></paper-input>
          <paper-tooltip for="title" offset="-7" position="bottom">ex : Set color in RGB</paper-tooltip>
          <paper-input always-float-label id="description" label="{{localize('description')}}" value="{{command.description}}" required auto-validate error-message="This field is required!" maxlength="150" on-change="validateForm"></paper-input>
          <paper-tooltip for="description" offset="-7" position="bottom">ex : Changes color of module to specified RGB color</paper-tooltip>
          <paper-input always-float-label id="command" label="{{localize('command')}}" value="{{command.command}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
          <paper-tooltip for="command" offset="-7" position="bottom">ex : 2702</paper-tooltip>

          <template is="dom-if" if="{{argumentAdded}}">
            <span class="field">{{localize('argument')}}</span>
            <nexpaq-driver-form-arguments added="{{argumentAdded}}" language="[[language]]" resources="[[resources]]" arguments="{{command.arguments}}" sent-data="{{sentData}}" command-index="{{commandIndex}}" valid={{valid}}></nexpaq-driver-form-arguments>
          </template>
          <template is="dom-if" if="{{!argumentAdded}}">
            <paper-button raised class="indigo mid" on-click="toggleArgument"> + Add Argument</paper-button>
          </template>

          <template is="dom-if" if="{{dataAdded}}">
            <span class="field">{{localize('data')}}</span>
            <nexpaq-driver-form-data added="{{dataAdded}}" language="[[language]]" resources="[[resources]]" command-data="{{command.data}}" sent-data="{{sentData}}" command-index="{{commandIndex}}" valid={{valid}}></nexpaq-driver-form-data>
          </template>
          <template is="dom-if" if="{{!dataAdded}}">
            <paper-button raised class="indigo mid" on-click="toggleData"> + Add Data</paper-button>
          </template>
        </template>
        <paper-button raised class="indigo main outer" on-click="addMoreCommands"> + {{localize('add')}} {{localize('command')}}</paper-button>
      </div>
    </template>
    <template is="dom-if" if="{{!commandAdded}}">
      <paper-button raised class="indigo main" on-click="toggleCommand"> + Add Command</paper-button>
    </template>

  </template>
  <script>
    class NexpaqDriverFormSentData extends Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior], NexpaqDriverCommonFunctions(Polymer.Element)){
      static get is() { return 'nexpaq-driver-form-sent-data' }
      static get properties() {
        return {
        	sentData: {
            type: Object,
            notify: true,
            reflectToAttribute: true,
            value: function() {
              return {
                type: "nexpaq.module",
                version: "1.0.0"
              };
            }
          },
          commandAdded: {
            type: Boolean,
            notify: true,
            value: function() {
              return false;
            }
          },
          dataAdded: {
            type: Boolean,
            notify: true,
            value: function() {
              return false;
            }
          },
          argumentAdded: {
            type: Boolean,
            notify: true,
            value: function() {
              return false;
            }
          },
          valid: {
            type: Boolean,
            notify: true,
            value: function() {
              return true;
            }
          },
        }
      }

      toggleData(e) {
        this.dataAdded = true;
        var i = e.model.commandIndex;
        var item = 'sentData.commands.'+i+'.data';
        this.set(item, [{}]);
      }

      toggleArgument(e) {
        this.argumentAdded = true;
        var i = e.model.commandIndex;
        var item = 'sentData.commands.'+i+'.arguments';
        this.set(item, [{}]);
      }

      addMoreCommands(e) {
        var item = 'sentData.commands';
        this.push(item,{});
      }

      removeCommand(e) {
        if(this.sentData.commands.length == 1) {
          delete this.sentData['commands'];
          this.notifyPath('sentData.commands');
          this.toggleCommand();
        } else {
          var item = 'sentData.commands';
          var index = e.model.commandIndex;
          this.splice(item, index, 1);
        }
      }

      toggleCommand() {
        if(this.commandAdded) {
          this.commandAdded = false;
        } else {
          this.commandAdded = true;
          var item = 'sentData.commands';
          this.set(item,[{}]);
        }
      }
    }
    customElements.define(NexpaqDriverFormSentData.is, NexpaqDriverFormSentData);
  </script>
</dom-module>
