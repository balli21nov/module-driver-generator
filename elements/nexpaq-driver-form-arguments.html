<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../mixins/nexpaq-driver-common-functions.html">
<link rel="import" href="../styles/nexpaq-driver-form-common-styles.html">

<dom-module id="nexpaq-driver-form-arguments">
  <template>
  	<style include="nexpaq-driver-form-common-styles">

      :host {
        display: block;
        box-sizing: border-box;
        position: relative;
      }

    </style>
    <template is="dom-if" if="{{added}}">
      <div class = "wrapper clearfix">
        <span class="field">{{localize('arguments')}}</span>
        <div class="subfield-container">
      <template is="dom-repeat" items="{{arguments}}" as="argument" index-as="argumentIndex">
          <div class="wrapper clearfix">
            <span class="close" on-click = "removeArgument">&times;</span>
            <paper-input class= "container-left" always-float-label id="name" label="{{localize('argumentName')}}" value="{{argument.name}}" auto-validate maxlength="50" on-change="validateForm"></paper-input>
            <paper-tooltip for="name" offset="-7" position="bottom">ex : Red</paper-tooltip>
            <paper-input class= "container-right" always-float-label id="validation" label="{{localize('validation')}}" value="{{argument.validation}}" auto-validate maxlength="50" on-change="validateForm"></paper-input>
            <paper-tooltip for="validation" offset="-7" position="bottom">ex : ({0} >= 0) and ({0} <= 255)</paper-tooltip>
          </div>
      </template>
      <paper-button raised class="indigo clearfix" on-click="addMoreArgument"> + {{localize('addMore')}} {{localize('argument')}}</paper-button>
    </div>
    </div>
    </template>
    <template is="dom-if" if="{{!added}}">
    <paper-button raised class="indigo clearfix mid" on-click="toggleArgument"> + Add Argument</paper-button>
    </template>
  </template>
  <script>
    // Extend Polymer.Element base class
    class DriverFormArguments extends Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior], NexpaqDriverCommonFunctions(Polymer.Element)) {

      static get is() { return 'nexpaq-driver-form-arguments' }

      static get properties() {
        return {
          arguments: {
            type: Array,
            notify: true
          },
          added: {
            type: Boolean,
            notify: true,
            value: function() {
              return false;
            }
          },
          command: {
            type: Number,
            notify: true
          }

        }
      }

      addMoreArgument(e) {
        this.push('arguments', {});
      }

      removeArgument(e) {
        if(e.model.itemsIndex == 0) {
          this.toggleArgument();
        }
        var index = e.model.argumentIndex;
        this.splice('arguments', index, 1);
      }

      toggleArgument(e) {
        if(this.added) {
          this.added = false;
        } else {
          this.added = true;
          // var i = e.model.commandIndex;
          var i = this.command;
          console.log(i);
          var item = 'sentData.commands.'+i+'.arguments';
          this.set(item, [{}]);
        }
      }
    }

    // Register custom element definition using standard platform API
    customElements.define(DriverFormArguments.is, DriverFormArguments);
  </script>
</dom-module>
