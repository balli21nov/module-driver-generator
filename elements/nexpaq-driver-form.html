<!-- Load the Polymer.Element base class -->
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<dom-module id="nexpaq-driver-form">
  <template>
  	<style>
      :host {
        display: block;
        box-sizing: border-box;
        padding: 10px;
        position: relative;
      }

      paper-tooltip {
        --paper-tooltip-opacity: 0.8;
        --paper-tooltip-background: black ;
        --paper-tooltip-text-color: white;
        width: 120px;
        font-size: 13px;
      }
      paper-button.indigo {
        color: white;
        background-color: #606060;
        float: right;
        font-size: 9px;
        width: 25%; height: 9%;
      }
      paper-button.indigo.outer {
        margin-top: 25px;
        clear: right;
        float: right;
        font-size: 10px;
        width: 30%; height: 12%;
      }

      h4 {
        color: #606060;
        font-weight: 500;
        text-align: center;
        padding-top: 24px;
        display: block;
      }
      .container-left {
        float: left;
        width: 45%;
      }
      .container-right {
        float: right;
        width: 45%;
      }
      .clearfix {
        clear: right;
      }
      .subfield-container {
      	margin-left: 25px;
      }

      paper-input {
      	--secondary-text-color: #9b9b9b;
      	--paper-font-subhead_-_font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      }
      span {
      	color: #9b9b9b;
      	font-size: 12px;
      	font-weight: 300;
      	font-family: Helvetica, Arial, sans-serif;
      	line-height: 24px;
      }

    </style>

    <h4>Sending Data</h4>
    <paper-input always-float-label id="type" label="Type" value="{{sentData.type}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
    <paper-tooltip for="type" offset="-7" position="bottom">ex : nexpaq.module.led</paper-tooltip>

    <paper-input always-float-label id="version" label="Version" value="{{sentData.version}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
    <paper-tooltip for="version" offset="-7" position="bottom">ex : 1.0.0</paper-tooltip>

    <span>Commands</span>
    <div class="subfield-container">
	    <template is="dom-repeat" items="{{sentData.commands}}">
	      <paper-input always-float-label id="name" label="Name" value="{{item.name}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	      <paper-tooltip for="name" offset="-7" position="bottom">ex : SetRGB</paper-tooltip>
	      <paper-input always-float-label id="title" label="Title" value="{{item.title}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	      <paper-tooltip for="title" offset="-7" position="bottom">ex : Set color in RGB</paper-tooltip>
	      <paper-input always-float-label id="description" label="Description" value="{{item.description}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	      <paper-tooltip for="description" offset="-7" position="bottom">ex : Changes color of module to specified RGB color</paper-tooltip>
	      <span>Arguments</span>
	      <div class="subfield-container">
		      <template is="dom-repeat" items="{{item.arguments}}">
	          <paper-input class= "container-left" always-float-label id="name" label="Name" value="{{item.name}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	          <paper-tooltip for="name" offset="-7" position="bottom">ex : Red</paper-tooltip>
	          <paper-input class= "container-right" always-float-label id="validation" label="Validation" value="{{item.validation}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	          <paper-tooltip for="validation" offset="-7" position="bottom">ex : ({0} >= 0) and ({0} <= 255)</paper-tooltip>
            <paper-button raised class="indigo"> + Add More Fields</paper-button>
		      </template>
	      </div>
	      <paper-input class="clearfix" always-float-label id="command" label="Command" value="{{item.command}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	      <paper-tooltip for="command" offset="-7" position="bottom">ex : 2702</paper-tooltip>

	      <span>Data</span>
	      <div class="subfield-container">
		      <template is="dom-repeat" items="{{item.data}}">
		        <paper-input class="clearfix" always-float-label id="defaultValue" label="Default Value" value="{{item.defaultValue}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
		        <paper-tooltip for="defaultValue" offset="-7" position="bottom">ex : 0</paper-tooltip>
	          <paper-input class= "container-left" always-float-label id="convert" label="Convert" value="{{item.convert}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	          <paper-tooltip for="convert" offset="-7" position="bottom">ex : true</paper-tooltip>
	          <paper-input class= "container-right" always-float-label id="format" label="Format" value="{{item.format}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	          <paper-tooltip for="format" offset="-7" position="bottom">ex : ({0} >> 8) & 0xFF</paper-tooltip>
            <paper-button raised class="indigo"> + Add More Fields</paper-button>
		      </template>
		    </div>
	    </template>
      <paper-button raised class="indigo outer"> + Add More Commands</paper-button>
    </div>
    <h4 class="clearfix">Receiving Data</h4>
  	<span>Data</span>
  	<div class="subfield-container">
	  	<template is="dom-repeat" items="{{receivedData.data}}">
	  		<paper-input always-float-label id="name" label="Name" value="{{item.name}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	      <paper-tooltip for="name" offset="-7" position="bottom">ex : SensorValue</paper-tooltip>
	      <paper-input always-float-label id="title" label="Title" value="{{item.title}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	      <paper-tooltip for="title" offset="-7" position="bottom">ex : Sensor value</paper-tooltip>
	      <paper-input always-float-label id="description" label="Description" value="{{item.description}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	      <paper-tooltip for="description" offset="-7" position="bottom">ex : Value from Temperature and Humidity sensor</paper-tooltip>
	      <paper-input always-float-label id="source" label="Source" value="{{item.source}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
	      <paper-tooltip for="source" offset="-7" position="bottom">ex : 2800</paper-tooltip>
	      <span>Variables</span>
	      <div class="subfield-container">
		      <template is="dom-repeat" items="{{item.variables}}">
			      <paper-input always-float-label id="name" label="Name" value="{{item.name}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
			      <paper-tooltip for="name" offset="-7" position="bottom">ex : humidity</paper-tooltip>
			      <paper-input always-float-label id="title" label="Title" value="{{item.title}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
			      <paper-tooltip for="title" offset="-7" position="bottom">ex : Humidity</paper-tooltip>
			      <paper-input always-float-label id="description" label="Description" value="{{item.description}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
			      <paper-tooltip for="description" offset="-7" position="bottom">ex : Ambient humidity detected by module</paper-tooltip>
			      <paper-input always-float-label id="data" label="Data" value="{{item.data}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
			      <paper-tooltip for="source" offset="-7" position="bottom">ex : 0, 1</paper-tooltip>
			      <span>State</span>
			      <div class="subfield-container">
			      	<template is="dom-repeat" items="{{toArray(item.state)}}">
					      <paper-input class= "container-left" always-float-label id="key" label="Key" value="{{item.stateKey}}" auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
					      <paper-tooltip for="key" offset="-7" position="bottom">ex : 00</paper-tooltip>
					      <paper-input class= "container-right" always-float-label id="value" label="Value" value="{{item.value}}" auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
					      <paper-tooltip for="value" offset="-7" position="bottom">ex : success</paper-tooltip>
                <paper-button raised class="indigo"> + Add More Fields</paper-button>
				      </template>
			      </div>
			      <paper-input class="clearfix" always-float-label id="format" label="Format" value="{{item.format}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
			      <paper-tooltip for="format" offset="-7" position="bottom">ex : 175.75 * ({0} * 256 + {1} / 4 * 4) / 65536 - 46.85</paper-tooltip>
			      <paper-input always-float-label id="source" label="Source" value="{{item.source}}" required auto-validate error-message="This field is required!" maxlength="50" on-change="validateForm"></paper-input>
			      <paper-tooltip for="source" offset="-7" position="bottom">ex : data</paper-tooltip>
			    </template>
          <paper-button raised class="indigo outer"> + Add More Variables</paper-button>
		    </div>
		  </template>
      <paper-button raised class="indigo outer"> + Add More Data</paper-button>
	  </div>
  </template>
  <script>

    // Extend Polymer.Element base class
    class DriverForm extends Polymer.Element {

      static get is() { return 'nexpaq-driver-form' }

      static get properties() {
        return {
        	sentData: {
            type: Object,
            notify: true,
            value: function() {
              return {
                commands: [{
                  arguments: [{}],
                  data: [{}]
                }]
              };
            }
          },
          receivedData: {
            type: Object,
            notify: true,
            value: function() {
              return {
                data: [{
                  variables: [{
                    state: {"":""}
                  }]
                }]
              };
            }
          },
          valid: {
            type: Boolean,
            notify: true,
            value: function() {
              return false;
            }
          }
        }
      }

      ready() {
        super.ready();

      }

      /**
       * Validates the form by checking each
       * paper input field.
       * @param {object}
       */
      validateForm() {
        var paperInputs = Polymer.dom(this.root).querySelectorAll("paper-input");
        for (var i=0; i<paperInputs.length; i++) {
          if (!this.validateField(paperInputs[i])) {
            this.valid = false;
            return;
          }
        }
        this.valid = true;
        return;
      }

      /**
       * Checks if the field is valid and required
       * field is filled.
       * @param {object}
       */
      validateField(field) {
        if(field.invalid) return false;
        if(field.required) {
          if (field.value == null || field.value == "") return false;
        }
        return true;
      }

      toArray(obj) {
           return Object.keys(obj).map(function(key) {
               return {
                   stateKey: key,
                   value: obj[key]
               };
           });
       }
    }

    // Register custom element definition using standard platform API
    customElements.define(DriverForm.is, DriverForm);
  </script>
</dom-module>
